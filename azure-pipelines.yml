trigger:
- 'master'

pool:
  vmImage: vs2017-win2016


variables:
  ConnectionString: 'Server=tcp:sqlserver-demo-subodh.database.windows.net,1433;Initial Catalog=Products;Persist Security Info=False;User ID=subodh;Password={your_password};MultipleActiveResultSets=False;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;'
  subscriptionID: 'Visual Studio Enterprise Subscription (13d31264-17e6-4ba7-9ee8-6fdc87d6a4ee)'

steps:

- task: CopyFiles@2
  displayName: 'Copy Files to: $(Build.ArtifactStagingDirectory)/SQL'
  inputs:
    SourceFolder: SqlServerDatabase
    Contents: '**.sql'
    TargetFolder: '$(Build.ArtifactStagingDirectory)'
    CleanTargetFolder: true
    preserveTimestamp: true

- task: PublishBuildArtifacts@1
  displayName: 'Publish Artifact: SQL'
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)'
    ArtifactName: SQL

- task: SqlAzureDacpacDeployment@1
  displayName: 'Azure SQL SqlTask'
  inputs:
    azureSubscription: '$(subscriptionID)'
    AuthenticationType: connectionString
    ConnectionString: '$(connectionString)'
    deployType: SqlTask
    SqlFile: '$(build.artifactstagingdirectory)/*.sql'

